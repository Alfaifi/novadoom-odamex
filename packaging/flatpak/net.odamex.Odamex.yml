# yaml-language-server: $schema=https://raw.githubusercontent.com/flatpak/flatpak-builder/main/data/flatpak-manifest.schema.json
---
app-id: net.odamex.Odamex
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
command: odamex
separate-locales: false
finish-args:
  - --share=ipc
  - --device=dri
  - --socket=pulseaudio
  - --share=network
  - --socket=wayland
  - --socket=x11
  - --socket=fallback-x11
  - --filesystem=host
modules:
  - name: SDL2-mixer
    buildsystem: cmake
    builddir: true
    config-opts:
      - -D SDL2_MIXER_VENDORED=ON
    cleanup:
      - "/bin/sdl2-config"
      - "/include"
      - "/lib/libSDL2.la"
      - "/lib/libSDL2main.a"
      - "/lib/libSDL2main.la"
      - "/lib/libSDL2_test.a"
      - "/lib/libSDL2_test.la"
      - "/lib/cmake"
      - "/share/aclocal"
      - "/lib/pkgconfig"
    sources:
      - type: archive
        url: https://www.libsdl.org/projects/SDL_mixer/release/SDL2_mixer-2.8.1.tar.gz
        sha256: cb760211b056bfe44f4a1e180cc7cb201137e4d1572f2002cc1be728efd22660
  # Odamex (combined)
  - name: Odamex
    buildsystem: simple
    only-arches:
      - x86_64
      - aarch64
    build-options:
      build-args:
        - --share=network
    build-commands:
      - chmod +x ./flatpak-buildgen.sh
      - "./flatpak-buildgen.sh"
    sources:
      - type: file
        url: https://github.com/Doom-Utils/deutex/releases/download/v5.2.2/deutex-5.2.2.tar.zst
        sha256: 10ed0e7a533ec97cb6d03548d4258fbec88852a45b5ea4cf5434376ad4174b5f
      - type: file
        url: https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.5/wxWidgets-3.0.5.tar.bz2
        sha256: 8aacd56b462f42fb6e33b4d8f5d40be5abc3d3b41348ea968aa515cc8285d813
      - type: dir
        path: ../../../odamex
      - type: file
        path: ./flatpak-buildgen.sh
